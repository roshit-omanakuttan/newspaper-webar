<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Newspaper WebAR</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#0b0b10}
    #ar{width:100%;height:100%}
  </style>
  <link rel="icon" href="data:,"/>
</head>
<body>
<div id="ar"></div>

<script type="module">
  // --- tiny script loader that returns a Promise ---
  const loadScript = (src) => new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = src;
    s.onload = resolve;
    s.onerror = () => reject(new Error('Failed to load ' + src));
    document.head.appendChild(s);
  });

  // 1) Load Three + GLTFLoader (UMD, set window.THREE)
  await loadScript('https://unpkg.com/three@0.154.0/build/three.min.js');
  await loadScript('https://unpkg.com/three@0.154.0/examples/js/loaders/GLTFLoader.js');

  // 2) Load MindAR UMD (try multiple CDNs)
  const mindArUMDs = [
    'https://unpkg.com/mind-ar@1.1.7/dist/mindar-image-three.prod.js',
    'https://cdn.jsdelivr.net/npm/mind-ar@1.1.7/dist/mindar-image-three.prod.js'
  ];
  let loaded = false;
  for (const url of mindArUMDs) {
    try { await loadScript(url); loaded = true; break; } catch (e) { /* try next */ }
  }
  if (!loaded || !window.MINDAR || !window.MINDAR.IMAGE) {
    console.error('MindAR UMD failed to load.');
    throw new Error('MindAR UMD failed to load');
  }

  // 3) Now safe to use MindAR
  const THREE_AR = window.MINDAR.IMAGE.THREE;
  const mindarThree = new window.MINDAR.IMAGE.MindARThree({
    container: document.querySelector('#ar'),
    imageTargetSrc: './targets.mind',
    filterMinCF: 0.0001, filterBeta: 0.01
  });
  const { renderer, scene, camera } = mindarThree;

  // Lighting
  scene.add(new THREE_AR.HemisphereLight(0xffffff, 0x444444, 1.0));

  // Anchor
  const anchor = mindarThree.addAnchor(0);

  // Background video plane
  const video = document.createElement('video');
  video.src = './cosmic.mp4';
  video.playsInline = true; video.loop = true; video.
